---
phase: 08-post-purchase-features
plan: 03
type: execute
wave: 3
depends_on: ["08-02"]
files_modified:
  - frontend/src/features/will/components/WillDashboard.tsx
  - frontend/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Authenticated user sees dashboard listing their wills"
    - "User can click Resume to load an existing will and continue from where they left off"
    - "User can click Create New Will to start a fresh will"
    - "Dashboard shows will status, last updated date, and version"
  artifacts:
    - path: "frontend/src/features/will/components/WillDashboard.tsx"
      provides: "Dashboard listing user wills with resume and create actions"
      min_lines: 40
    - path: "frontend/src/App.tsx"
      provides: "Updated routing with dashboard as authenticated home"
      contains: "WillDashboard"
  key_links:
    - from: "frontend/src/features/will/components/WillDashboard.tsx"
      to: "frontend/src/services/api.ts"
      via: "listWills and getWill API calls"
      pattern: "listWills|getWill"
    - from: "frontend/src/features/will/components/WillDashboard.tsx"
      to: "frontend/src/features/will/store/useWillStore.ts"
      via: "loadFromServer and resetWill actions"
      pattern: "loadFromServer|resetWill"
---

<objective>
Create the WillDashboard component showing a user's wills and replace the authenticated home page with it. Users can resume existing drafts or create new wills.

Purpose: Entry point for resume flow. Without a dashboard, users have no way to discover and resume existing wills. The dashboard also shows paid wills for post-purchase updates.
Output: WillDashboard component, updated App.tsx routing.
</objective>

<execution_context>
@/home/laudes/.claude/get-shit-done/workflows/execute-plan.md
@/home/laudes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/08-post-purchase-features/08-02-SUMMARY.md
@frontend/src/App.tsx
@frontend/src/services/api.ts
@frontend/src/features/will/store/useWillStore.ts
@frontend/src/features/will/types/will.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: WillDashboard component</name>
  <files>
    frontend/src/features/will/components/WillDashboard.tsx
  </files>
  <action>
    Create `frontend/src/features/will/components/WillDashboard.tsx`:

    This component replaces the old `MainContent` as the authenticated home page.

    **Behavior:**
    1. On mount, fetches user's wills via `useQuery` with `queryKey: ['wills']` and `queryFn: listWills`
    2. Shows loading spinner while fetching
    3. If no wills exist: show welcome message + "Create Your Will" CTA button
    4. If wills exist: show a list of will cards + "Create New Will" button

    **Will Card** for each will:
    - Status badge: uses DaisyUI `badge` — "Draft" (badge-warning), "In Review" (badge-info), "Verified" (badge-success), "Generated" (badge-accent), plus a separate "Paid" badge (badge-primary) if `paid_at` is set
    - Last updated: human-readable date (use `new Date(will.updated_at).toLocaleDateString()`)
    - Version: show "v{version}" if version > 1
    - Testator name: extract from `will.testator.first_name` + `will.testator.last_name` (fallback "Untitled Will")
    - Action buttons:
      - If `paid_at` set: "Update Will" (btn btn-neutral) and "Download" link (btn btn-soft, navigates to `/download/{latest_download_token}` if available — or just show "Update Will" to re-enter wizard)
      - If `paid_at` not set: "Resume Draft" (btn btn-neutral)

    **Resume action** (`handleResume`):
    1. Call `getWill(willId)` to fetch full data
    2. Call `loadFromServer(will)` to hydrate Zustand
    3. Navigate to `/will` via `useNavigate()`

    **Create new action** (`handleCreateNew`):
    1. Call `resetWill()` on the Zustand store (clears localStorage)
    2. Navigate to `/will`

    **Layout:** Use the existing app layout pattern:
    - Navbar with "WillCraft SA", tagline (hidden sm), ThemeToggle, UserButton
    - Main content area: max-w-4xl mx-auto px-4 py-8
    - Cards: use DaisyUI `card bg-base-100 shadow-sm` with `card-body`
    - Use `space-y-4` for the will list

    **Imports:**
    - `useQuery` from `@tanstack/react-query`
    - `useNavigate` from `react-router-dom`
    - `listWills, getWill` from `../../../services/api`
    - `useWillStore` from `../store/useWillStore`
    - `UserButton` from `@clerk/clerk-react`
    - `ThemeToggle` from `../../../components/ui/ThemeToggle`
    - Type `WillResponse` from `../../../services/api`

    **Empty state** (no wills):
    ```
    card bg-base-100 shadow-sm
      card-body items-center text-center space-y-4
        h2.card-title.text-2xl "Welcome to WillCraft SA"
        p.text-base-content/70 "Create your legally compliant South African will..."
        Link to="/will" btn btn-neutral btn-lg "Create Your Will"
    ```

    **With wills** state:
    ```
    div.space-y-4
      div.flex.justify-between.items-center
        h2.text-2xl.font-bold "Your Wills"
        Link to="/will" onClick={handleCreateNew} btn btn-neutral "Create New Will"
      {wills.map(will => WillCard)}
    ```

    Use DaisyUI classes only — no custom CSS.
  </action>
  <verify>
    File exists at `frontend/src/features/will/components/WillDashboard.tsx`.
    Imports compile: `cd /opt/lampp/htdocs/wdi/frontend && npx tsc --noEmit 2>&1 | head -20`.
  </verify>
  <done>WillDashboard component renders a list of user wills with resume/create actions, shows loading state, empty state, and will cards with status badges.</done>
</task>

<task type="auto">
  <name>Task 2: Replace MainContent with WillDashboard in App.tsx routing</name>
  <files>
    frontend/src/App.tsx
  </files>
  <action>
    Update `frontend/src/App.tsx`:

    1. Import `WillDashboard` from `'./features/will/components/WillDashboard.tsx'`.

    2. Replace the `MainContent` component entirely with a new version that renders `WillDashboard`:
    ```tsx
    function MainContent() {
      const { hasConsent, isLoading } = useConsent()

      if (isLoading) {
        return (
          <div className="flex items-center justify-center min-h-screen">
            <span className="loading loading-spinner loading-lg text-primary"></span>
          </div>
        )
      }

      if (!hasConsent) {
        return null
      }

      return <WillDashboard />
    }
    ```

    This replaces the old "Welcome to WillCraft SA" card with the dashboard. The navbar is now inside WillDashboard itself, keeping consistency.

    3. The route structure stays the same — `<Route path="*"` renders `MainContent` which now shows the dashboard. No new routes needed since `/will` still goes to `WillPage`.

    4. Remove unused imports from the old MainContent if any: The `Link` import from react-router-dom may no longer be needed in App.tsx (check if any other component uses it). The `UserButton` and `ThemeToggle` imports may also be unused in App.tsx if the dashboard handles its own navbar. Check and clean up.

    **IMPORTANT**: Keep `LandingPage`, `WillPage`, `AuthGatedContent` components as they are. Only replace the body of `MainContent`.
  </action>
  <verify>
    Run `cd /opt/lampp/htdocs/wdi/frontend && npx tsc --noEmit 2>&1 | head -20` — should compile clean.
    Verify `MainContent` now renders `WillDashboard` by grepping: `grep -n "WillDashboard" frontend/src/App.tsx`.
  </verify>
  <done>Authenticated home page renders WillDashboard. Route structure preserved. LandingPage still shows for unauthenticated users.</done>
</task>

</tasks>

<verification>
1. WillDashboard.tsx exists and renders will list
2. Dashboard fetches wills via @tanstack/react-query
3. Resume button loads will data into Zustand via loadFromServer and navigates to /will
4. Create New Will clears Zustand and navigates to /will
5. Will cards show status, date, version, testator name
6. App.tsx MainContent renders WillDashboard for authenticated users
7. Frontend compiles without errors
</verification>

<success_criteria>
- Authenticated user sees WillDashboard at home route
- Dashboard shows all user wills with correct status badges
- Resume loads existing will data and navigates to wizard
- Create new starts a fresh will
- Paid wills show "Update Will" button
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-post-purchase-features/08-03-SUMMARY.md`
</output>
