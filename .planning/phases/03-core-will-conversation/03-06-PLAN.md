---
phase: 03-core-will-conversation
plan: 06
type: execute
wave: 2
depends_on: ["03-03"]
files_modified:
  - frontend/src/features/will/components/WillWizard.tsx
  - frontend/src/features/will/components/StepIndicator.tsx
  - frontend/src/features/will/components/PersonalForm.tsx
  - frontend/src/features/will/components/MaritalForm.tsx
  - frontend/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Step indicator shows all sections with completion state and allows clicking to navigate"
    - "Personal details form validates SA ID (13 digits), postal code (4 digits), and required fields"
    - "Marital form conditionally shows spouse fields when married status selected"
    - "Form data saves to Zustand store on submit"
    - "Wizard is accessible from the main app route"
  artifacts:
    - path: "frontend/src/features/will/components/WillWizard.tsx"
      provides: "Main wizard container that renders current section"
      contains: "WillWizard"
    - path: "frontend/src/features/will/components/StepIndicator.tsx"
      provides: "DaisyUI steps navigation with clickable sections"
      contains: "StepIndicator"
    - path: "frontend/src/features/will/components/PersonalForm.tsx"
      provides: "React Hook Form + Zod testator form"
      contains: "PersonalForm"
    - path: "frontend/src/features/will/components/MaritalForm.tsx"
      provides: "React Hook Form marital status form with conditional spouse fields"
      contains: "MaritalForm"
  key_links:
    - from: "frontend/src/features/will/components/WillWizard.tsx"
      to: "frontend/src/features/will/store/useWillStore.ts"
      via: "useWillStore() for current section and data"
    - from: "frontend/src/features/will/components/PersonalForm.tsx"
      to: "frontend/src/features/will/schemas/willSchemas.ts"
      via: "zodResolver(testatorSchema)"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/features/will/components/WillWizard.tsx"
      via: "Route path='/will'"
---

<objective>
Build the wizard shell (container + step indicator) and structured form sections (Personal Details + Marital Status) that capture testator essentials before the AI conversation begins.

Purpose: Per user decision, structured forms handle testator essentials (name, ID, DOB, address, marital status) before the AI takes over. This is the form-to-AI handoff point -- after these two forms, remaining sections use conversational AI.
Output: WillWizard container, DaisyUI steps indicator, PersonalForm, MaritalForm, route integration.
</objective>

<execution_context>
@/home/laudes/.claude/get-shit-done/workflows/execute-plan.md
@/home/laudes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/03-core-will-conversation/03-RESEARCH.md
@.planning/phases/03-core-will-conversation/03-CONTEXT.md
@.planning/phases/03-core-will-conversation/03-03-SUMMARY.md
@frontend/src/App.tsx
@frontend/src/features/will/store/useWillStore.ts
@frontend/src/features/will/schemas/willSchemas.ts
@frontend/src/features/will/types/will.ts
@frontend/src/features/will/hooks/useWillProgress.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WillWizard container and StepIndicator</name>
  <files>
    frontend/src/features/will/components/WillWizard.tsx
    frontend/src/features/will/components/StepIndicator.tsx
  </files>
  <action>
    Create StepIndicator.tsx (from RESEARCH.md Pattern 5):
    - Uses DaisyUI `steps steps-horizontal` component
    - Receives: currentSection, sectionsComplete, onNavigate callback
    - Sections array: Personal, Beneficiaries, Assets, Guardians, Executor, Bequests, Residue, Review
    - Each step is clickable (onClick -> onNavigate(key))
    - Completed sections get `step-primary` class
    - Current section gets `step-neutral` class
    - Wrap in `overflow-x-auto` for mobile horizontal scrolling
    - Use `text-xs sm:text-sm` for mobile-first text sizing

    Create WillWizard.tsx:
    - Main container component that manages the wizard flow
    - Reads currentSection from useWillStore()
    - Reads sectionsComplete from useWillProgress()
    - Renders StepIndicator at top (always visible per user decision)
    - Below indicator, renders the appropriate section component based on currentSection:
      * 'personal' -> PersonalForm
      * 'marital' -> MaritalForm (included in Personal step for UX flow -- after Personal form submits, auto-advance to Marital)
      * 'beneficiaries' | 'assets' | 'guardians' | 'executor' | 'bequests' | 'residue' -> placeholder div for now (Plan 07 adds ChatSection)
      * 'review' -> placeholder div for now (Plan 08 adds WillPreview)
    - Personal step encompasses both PersonalForm and MaritalForm (grouped under "Personal" in step indicator)
    - Use DaisyUI card component as section container: card with card-body
    - Mobile-first: full width on mobile, max-w-3xl centered on desktop
  </action>
  <verify>cd frontend && npx tsc --noEmit 2>&1 | head -20</verify>
  <done>WillWizard renders step indicator and switches sections, StepIndicator allows navigation</done>
</task>

<task type="auto">
  <name>Task 2: Create PersonalForm and MaritalForm with React Hook Form + Zod</name>
  <files>
    frontend/src/features/will/components/PersonalForm.tsx
    frontend/src/features/will/components/MaritalForm.tsx
    frontend/src/App.tsx
  </files>
  <action>
    Create PersonalForm.tsx:
    - Uses useForm() from react-hook-form with zodResolver(testatorSchema)
    - Pre-populates from useWillStore().testator (for editing)
    - DaisyUI fieldset pattern for form groups (from 02.1 patterns)
    - Fields: firstName, lastName, idNumber, dateOfBirth (input type="date"), address, city, province (select with SA provinces), postalCode, phone (optional), email (optional)
    - Province select: Eastern Cape (EC), Free State (FS), Gauteng (GP), KwaZulu-Natal (KZN), Limpopo (LP), Mpumalanga (MP), Northern Cape (NC), North West (NW), Western Cape (WC)
    - On submit: updateTestator(data) via useWillStore, then show MaritalForm (or auto-advance)
    - DaisyUI input classes: input, input-bordered, select, select-bordered
    - Error display: use DaisyUI text-error class under each field
    - Submit button: btn btn-primary
    - Mobile-first grid: single column on mobile, 2-column on md+

    Create MaritalForm.tsx:
    - Uses useForm() with zodResolver(maritalSchema)
    - Pre-populates from useWillStore().marital
    - Main field: Marital status select (Single, Married in community of property, Married with ANC, Married COP, Divorced, Widowed)
    - Conditional fields: when status starts with "married_", show spouse fields (spouseFirstName, spouseLastName, spouseIdNumber)
    - Additional conditional: marriedOutsideSa checkbox, if checked show marriageCountry
    - On submit: updateMarital(data), markSectionComplete('personal'), setCurrentSection('beneficiaries')
    - This is the handoff point: after marital form, user enters AI conversation territory

    Update frontend/src/App.tsx:
    - Add route for /will that renders WillWizard
    - Add a "Create Will" button/link on the home page that navigates to /will
    - Keep existing routes intact (privacy-policy, info-officer)
  </action>
  <verify>cd frontend && npx tsc --noEmit 2>&1 | head -20</verify>
  <done>PersonalForm validates SA fields, MaritalForm shows conditional spouse fields, both save to Zustand store, /will route accessible</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: cd frontend && npx tsc --noEmit
2. Route exists: grep "/will" frontend/src/App.tsx
3. Zod resolver used: grep "zodResolver" frontend/src/features/will/components/PersonalForm.tsx
4. DaisyUI steps used: grep "steps" frontend/src/features/will/components/StepIndicator.tsx
5. Store integration: grep "useWillStore" frontend/src/features/will/components/PersonalForm.tsx
</verification>

<success_criteria>
- WillWizard container renders step indicator + current section
- StepIndicator shows all sections, clickable, with completion states
- PersonalForm validates all testator fields with SA-specific rules
- MaritalForm conditionally renders spouse fields for married statuses
- Both forms save to Zustand store and advance to next section
- /will route added to App.tsx
- Mobile-first responsive layout
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-will-conversation/03-06-SUMMARY.md`
</output>
