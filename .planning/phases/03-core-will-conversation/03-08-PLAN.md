---
phase: 03-core-will-conversation
plan: 08
type: execute
wave: 4
depends_on: ["03-06", "03-07"]
files_modified:
  - frontend/src/features/will/components/SectionReview.tsx
  - frontend/src/features/will/components/ReviewChat.tsx
  - frontend/src/features/will/components/WillWizard.tsx
  - backend/app/prompts/system.py
autonomous: false

must_haves:
  truths:
    - "User can see a review/edit page for each section showing collected data"
    - "AI conversationally narrates the will in plain language and asks if anything needs changing"
    - "Review chat uses friendly language like 'Your estate goes 50% to Sarah, 50% to James'"
    - "User can request changes conversationally during review and be routed back to relevant section"
    - "All components work on mobile screens (chat, forms, steps indicator)"
  artifacts:
    - path: "frontend/src/features/will/components/SectionReview.tsx"
      provides: "Section-specific data review with edit capability"
      contains: "SectionReview"
    - path: "frontend/src/features/will/components/ReviewChat.tsx"
      provides: "AI-led interactive will review conversation"
      contains: "ReviewChat"
  key_links:
    - from: "frontend/src/features/will/components/SectionReview.tsx"
      to: "frontend/src/features/will/store/useWillStore.ts"
      via: "Reads section data from store"
    - from: "frontend/src/features/will/components/ReviewChat.tsx"
      to: "frontend/src/features/will/hooks/useConversation.ts"
      via: "Uses conversation hook with section='review'"
    - from: "backend/app/prompts/system.py"
      to: "SECTION_PROMPTS"
      via: "Adds 'review' section prompt that narrates will and asks for changes"
---

<objective>
Build section review pages, interactive AI-led will review conversation, and verify the complete wizard flow works on mobile.

Purpose: The review components complete the data collection phase. SectionReview lets users verify and edit collected data per section. ReviewChat implements the user decision for AI-led review: the AI conversationally walks through the entire will in plain language ("Your estate goes 50% to Sarah"), asks if anything needs changing, and routes users back to relevant sections for edits.
Output: SectionReview component, ReviewChat component, review system prompt, mobile-verified complete wizard.
</objective>

<execution_context>
@/home/laudes/.claude/get-shit-done/workflows/execute-plan.md
@/home/laudes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/03-core-will-conversation/03-RESEARCH.md
@.planning/phases/03-core-will-conversation/03-CONTEXT.md
@.planning/phases/03-core-will-conversation/03-06-SUMMARY.md
@.planning/phases/03-core-will-conversation/03-07-SUMMARY.md
@frontend/src/features/will/store/useWillStore.ts
@frontend/src/features/will/components/WillWizard.tsx
@frontend/src/features/will/types/will.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SectionReview, ReviewChat, and add review system prompt</name>
  <files>
    frontend/src/features/will/components/SectionReview.tsx
    frontend/src/features/will/components/ReviewChat.tsx
    frontend/src/features/will/components/WillWizard.tsx
    backend/app/prompts/system.py
  </files>
  <action>
    Create SectionReview.tsx:
    - Props: { section: WillSection, onEdit: (section: WillSection) => void }
    - Reads section data from useWillStore()
    - Renders a DaisyUI card with section-specific data display:
      * Personal: Name, ID, DOB, address, marital status, spouse details
      * Beneficiaries: List of beneficiaries with name, relationship, share %, alternate
      * Assets: List of assets with type, description
      * Guardians: Primary and backup guardians with names, relationships
      * Executor: Executor name, relationship, professional flag, backup
      * Bequests: List of specific bequests with item, recipient
      * Residue: Distribution plan, simultaneous death clause
    - Each section card has "Edit" button (btn btn-outline btn-sm) that calls onEdit(section) to navigate back to that section
    - Empty sections show "Not yet completed" with a "Start" button
    - Use DaisyUI table or description list for structured data display

    Create ReviewChat.tsx (AI-led interactive review — KEY USER DECISION):
    - This implements "AI-led review at completion: AI walks through a conversational summary of the entire will, asks if anything needs changing"
    - Uses useConversation() hook with section='review' — reuses the same chat infrastructure from Plan 07
    - On mount, automatically sends an initial system-triggered message that includes the FULL will state as context
    - The AI responds by narrating the will in plain language:
      "Let me walk through your will. You, [name], have decided that your estate will go 50% to Sarah (your daughter) and 50% to James (your son). If Sarah passes before you, her share goes to..."
    - AI then asks: "Does everything look right? Would you like to change anything?"
    - User can conversationally request changes: "Actually, I want to change Sarah's share to 60%"
    - AI acknowledges and suggests navigating to the relevant section: "Let's update that. I'll take you back to the Beneficiaries section."
    - Layout: same as ChatSection (DaisyUI chat bubbles, scrollable, sticky input) but with additional context
    - Below the chat: collapsible SectionReview cards for quick-reference data view
    - "Looks Good — Proceed" button (btn btn-primary) visible after AI has completed its narration — advances to next phase (placeholder for Phase 5 verification)

    Update backend/app/prompts/system.py:
    - Add 'review' entry to SECTION_PROMPTS dict:
      * "You are reviewing the user's complete will. Walk through ALL sections in plain, friendly language. "
      * "Narrate the will as if telling a story: 'You, [name], have decided that...' "
      * "Use phrases like 'your estate goes to', 'if [person] passes before you', 'your home at [address]'. "
      * "NEVER use legal jargon, data tables, or bullet-point lists. Make it conversational and readable. "
      * "After narrating, ask: 'Does everything look right? Would you like to change anything?' "
      * "If the user requests changes, acknowledge their request and suggest which section to navigate to. "
      * "Do NOT make changes yourself — guide the user to the appropriate section."

    Update WillWizard.tsx:
    - Wire 'review' section to render ReviewChat component
    - Pass willId and full will context to ReviewChat
    - Handle navigation requests from review back to specific sections
  </action>
  <verify>cd frontend && npx tsc --noEmit 2>&1 | head -20</verify>
  <done>SectionReview shows per-section data, ReviewChat enables AI-led interactive will narration with change requests, review prompt added to system.py</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete will creation wizard with:
    1. Step indicator navigation (Personal > Beneficiaries > Assets > Guardians > Executor > Bequests > Residue > Review)
    2. Personal Details form with SA ID validation
    3. Marital Status form with conditional spouse fields
    4. AI chat interface for beneficiaries, assets, guardians, executor, bequests, residue sections
    5. Section review pages with edit capability
    6. Interactive AI-led will review conversation (AI narrates the will, asks if changes needed)
  </what-built>
  <how-to-verify>
    1. Start frontend: cd frontend && npm run dev
    2. Navigate to http://localhost:5173/will
    3. Verify step indicator shows all sections, is scrollable on mobile
    4. Fill Personal Details form:
       - Try invalid SA ID (12 digits) -- should show error
       - Try valid 13-digit ID -- should accept
       - Submit with all required fields
    5. Fill Marital Status:
       - Select "Single" -- no spouse fields shown
       - Select "Married in community of property" -- spouse fields appear
       - Submit -- should advance to Beneficiaries section
    6. In Beneficiaries chat:
       - Type "I want to leave everything to my daughter Sarah" (if backend running with OpenAI key)
       - OR verify chat UI renders: input field, send button, section heading
       - Verify chat bubbles use correct styling (AI on left, user on right)
    7. Click through step indicator to jump to different sections
    8. Navigate to Review section:
       - AI should narrate the will conversationally ("You, [name], have decided that...")
       - AI should ask "Does everything look right?"
       - Try requesting a change — AI should guide you to the right section
       - Collapsible section review cards visible below chat
    9. Test on mobile viewport (Chrome DevTools, 375px width):
       - Steps indicator scrolls horizontally
       - Forms are single-column
       - Chat input is sticky at bottom
       - No content cut off by keyboard area
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compiles: cd frontend && npx tsc --noEmit
2. Build succeeds: cd frontend && npm run build
3. All will components exist in features/will/components/
4. Review chat component: grep "ReviewChat\|useConversation" frontend/src/features/will/components/ReviewChat.tsx
5. Review system prompt: grep "review" backend/app/prompts/system.py
6. Section review has edit buttons: grep "onEdit\|btn-outline" frontend/src/features/will/components/SectionReview.tsx
</verification>

<success_criteria>
- SectionReview displays collected data per section with edit buttons
- ReviewChat enables AI-led interactive will narration (AI walks through will, asks for changes)
- Review system prompt instructs AI to narrate in plain language, not legal jargon
- Complete wizard flow: Personal form -> Marital form -> AI chat sections -> AI Review
- Step indicator allows flexible navigation between any sections
- All components responsive and mobile-friendly
- Human verification of complete flow
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-will-conversation/03-08-SUMMARY.md`
</output>
