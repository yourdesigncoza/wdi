---
phase: 03-core-will-conversation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/src/features/will/types/will.ts
  - frontend/src/features/will/store/useWillStore.ts
  - frontend/src/features/will/schemas/willSchemas.ts
  - frontend/src/features/will/hooks/useWillProgress.ts
autonomous: true

must_haves:
  truths:
    - "Zustand store persists will data to localStorage under 'wdi-will-draft' key"
    - "TypeScript types cover all will sections (testator, marital, beneficiaries, assets, guardians, executor, bequests, residue)"
    - "Zod schemas validate testator and marital form inputs with SA-specific rules (13-digit ID, 4-digit postal code)"
    - "Will progress hook tracks section completion state"
  artifacts:
    - path: "frontend/src/features/will/types/will.ts"
      provides: "TypeScript interfaces for all will data types"
      contains: "interface Testator"
    - path: "frontend/src/features/will/store/useWillStore.ts"
      provides: "Zustand store with persist + immer middleware"
      contains: "useWillStore"
    - path: "frontend/src/features/will/schemas/willSchemas.ts"
      provides: "Zod validation schemas for form sections"
      contains: "testatorSchema"
    - path: "frontend/src/features/will/hooks/useWillProgress.ts"
      provides: "Section completion tracking hook"
      contains: "useWillProgress"
  key_links:
    - from: "frontend/src/features/will/store/useWillStore.ts"
      to: "localStorage"
      via: "zustand persist middleware with key 'wdi-will-draft'"
    - from: "frontend/src/features/will/schemas/willSchemas.ts"
      to: "frontend/src/features/will/types/will.ts"
      via: "Zod infer for type consistency"
---

<objective>
Install frontend dependencies (zustand, immer, react-hook-form, zod, @hookform/resolvers) and create the will data foundation: TypeScript types, Zustand store with persistence, Zod validation schemas, and progress tracking hook.

Purpose: Establishes the frontend data layer that all UI components depend on -- persistent will state, form validation, and progress tracking across sections.
Output: npm packages installed, will types, Zustand store, Zod schemas, progress hook.
</objective>

<execution_context>
@/home/laudes/.claude/get-shit-done/workflows/execute-plan.md
@/home/laudes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/03-core-will-conversation/03-RESEARCH.md
@frontend/package.json
@frontend/src/services/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install frontend dependencies</name>
  <files>frontend/package.json</files>
  <action>
    cd frontend && npm install zustand immer react-hook-form @hookform/resolvers zod

    These are the core libraries from RESEARCH.md standard stack:
    - zustand: Will data state management with persist middleware
    - immer: Immutable nested state updates (beneficiaries[], assets[])
    - react-hook-form: Performant form handling for testator/marital sections
    - @hookform/resolvers: Bridges Zod schemas to React Hook Form
    - zod: Schema validation shared between forms and API

    Do NOT install eventsource-parser yet -- it will be added in Plan 07 when the SSE hook is built.
  </action>
  <verify>cd frontend && node -e "require('zustand'); require('immer'); require('react-hook-form'); require('@hookform/resolvers'); require('zod'); console.log('All deps OK')"</verify>
  <done>All 5 dependencies installed in frontend/package.json</done>
</task>

<task type="auto">
  <name>Task 2: Create will types, Zustand store, Zod schemas, and progress hook</name>
  <files>
    frontend/src/features/will/types/will.ts
    frontend/src/features/will/store/useWillStore.ts
    frontend/src/features/will/schemas/willSchemas.ts
    frontend/src/features/will/hooks/useWillProgress.ts
  </files>
  <action>
    Create directory structure: frontend/src/features/will/{types,store,schemas,hooks,components}/

    1. frontend/src/features/will/types/will.ts:
       Define TypeScript interfaces following RESEARCH.md Pattern 3:
       - Testator: firstName, lastName, idNumber, dateOfBirth, address, city, province, postalCode, phone, email
       - MaritalInfo: status (MaritalStatus enum), spouseFirstName?, spouseLastName?, spouseIdNumber?, marriedOutsideSa, marriageCountry?
       - Beneficiary: id (string), fullName, relationship, idNumber?, sharePercent?, alternateBeneficiary?, isCharity
       - Asset: id (string), assetType ('property'|'vehicle'|'bank_account'|'investment'|'insurance'|'business'|'other'), description, details?
       - Guardian: id (string), fullName, relationship, idNumber?, isPrimary
       - ExecutorInfo: name, relationship?, isProfessional, backupName?, backupRelationship?
       - Bequest: id (string), itemDescription, recipientName, recipientRelationship?
       - ResidueInfo: beneficiaries (array of {name, sharePercent}), simultaneousDeathClause?
       - WillSection type = 'personal' | 'beneficiaries' | 'assets' | 'guardians' | 'executor' | 'bequests' | 'residue' | 'review'
       - SectionsComplete: Record<string, boolean>
       - WillState: willId, testator, marital, beneficiaries, assets, guardians, executor, bequests, residue, sectionsComplete, currentSection
       - WillActions: setWillId, updateTestator, updateMarital, addBeneficiary, removeBeneficiary, updateBeneficiary, addAsset, removeAsset, addGuardian, removeGuardian, updateExecutor, addBequest, removeBequest, updateResidue, markSectionComplete, setCurrentSection, resetWill

    2. frontend/src/features/will/store/useWillStore.ts:
       Following RESEARCH.md Pattern 3 exactly:
       - Use create<WillState & WillActions>()(persist(immer((set) => ({...})), { name: 'wdi-will-draft' }))
       - All action implementations use immer's set() for nested mutations
       - initialState has all sections empty/default, sectionsComplete all false, currentSection 'personal'
       - resetWill replaces state with initialState

    3. frontend/src/features/will/schemas/willSchemas.ts:
       Zod schemas for form-based sections:
       - testatorSchema: z.object with all Testator fields, SA-specific validation:
         * idNumber: z.string().regex(/^\d{13}$/, "SA ID must be 13 digits")
         * postalCode: z.string().regex(/^\d{4}$/, "Postal code must be 4 digits")
         * firstName, lastName: z.string().min(1).max(100)
         * email: z.string().email().optional().or(z.literal(''))
         * province: z.enum(["EC","FS","GP","KZN","LP","MP","NC","NW","WC"])
       - maritalSchema: z.object with MaritalInfo fields, conditional validation:
         * If status is married_*, spouse fields become required (use z.refine or superRefine)
       - beneficiarySchema: z.object for inline validation when adding beneficiaries
       - Export inferred types: type TestatorFormData = z.infer<typeof testatorSchema>

    4. frontend/src/features/will/hooks/useWillProgress.ts:
       - useWillProgress() hook that derives from useWillStore:
         * sections: ordered array of {key: WillSection, label: string, isComplete: boolean, isCurrent: boolean}
         * completedCount: number of completed sections
         * totalSections: total (7 -- excluding 'review')
         * isAllComplete: boolean
         * canReview: boolean (all required sections complete -- personal, beneficiaries, executor, residue)
       - WILL_SECTIONS constant defining section order and labels: Personal, Beneficiaries, Assets, Guardians, Executor, Bequests, Residue, Review
  </action>
  <verify>
    cd frontend && npx tsc --noEmit 2>&1 | head -20 (TypeScript compilation check)
  </verify>
  <done>Will types, Zustand store with localStorage persistence, Zod schemas with SA validation, and progress hook all compile without TypeScript errors</done>
</task>

</tasks>

<verification>
1. npm ls zustand immer react-hook-form @hookform/resolvers zod (all installed)
2. TypeScript compiles: cd frontend && npx tsc --noEmit
3. Store key check: grep "wdi-will-draft" frontend/src/features/will/store/useWillStore.ts
4. SA ID regex check: grep "13" frontend/src/features/will/schemas/willSchemas.ts
</verification>

<success_criteria>
- 5 npm packages installed
- Complete TypeScript type coverage for all will sections
- Zustand store with persist middleware writing to 'wdi-will-draft'
- Zod schemas validating SA-specific fields (13-digit ID, 4-digit postal code, conditional spouse fields)
- Progress hook tracking section completion
- Zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-will-conversation/03-03-SUMMARY.md`
</output>
