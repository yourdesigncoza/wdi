---
phase: 04-complex-estate-scenarios
plan: 04
type: execute
wave: 2
depends_on: ["04-02"]
files_modified:
  - frontend/src/features/will/components/TrustSection.tsx
  - frontend/src/features/will/components/UsufructSection.tsx
  - frontend/src/features/will/components/BusinessAssetsSection.tsx
  - frontend/src/features/will/components/JointWillSetup.tsx
autonomous: true

must_haves:
  truths:
    - "User can configure testamentary trust provisions through a dedicated UI section"
    - "User can set up usufruct provisions with property and holder details"
    - "User can add business assets with CC/company/partnership specifics and consent warnings"
    - "User can configure joint/mirror will with co-testator details and irrevocability acknowledgement"
  artifacts:
    - path: "frontend/src/features/will/components/TrustSection.tsx"
      provides: "Testamentary trust configuration form with AI chat"
      exports: ["TrustSection"]
    - path: "frontend/src/features/will/components/UsufructSection.tsx"
      provides: "Usufruct provision configuration form with AI chat"
      exports: ["UsufructSection"]
    - path: "frontend/src/features/will/components/BusinessAssetsSection.tsx"
      provides: "Business asset questionnaire with CC consent warning"
      exports: ["BusinessAssetsSection"]
    - path: "frontend/src/features/will/components/JointWillSetup.tsx"
      provides: "Joint/mirror will setup with irrevocability warning"
      exports: ["JointWillSetup"]
  key_links:
    - from: "frontend/src/features/will/components/TrustSection.tsx"
      to: "frontend/src/features/will/store/useWillStore.ts"
      via: "updateTrustProvisions action"
      pattern: "useWillStore.*updateTrustProvisions"
    - from: "frontend/src/features/will/components/BusinessAssetsSection.tsx"
      to: "frontend/src/features/will/store/useWillStore.ts"
      via: "addBusinessAsset and removeBusinessAsset actions"
      pattern: "useWillStore.*addBusinessAsset"
---

<objective>
Create frontend UI components for all four complex estate scenario sections: trust, usufruct, business assets, and joint will.

Purpose: Users need dedicated interfaces to configure each complex scenario with proper SA legal context, warnings, and data collection.
Output: 4 new React components for complex section interaction.
</objective>

<execution_context>
@/home/laudes/.claude/get-shit-done/workflows/execute-plan.md
@/home/laudes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-complex-estate-scenarios/04-RESEARCH.md

@frontend/src/features/will/types/will.ts
@frontend/src/features/will/store/useWillStore.ts
@frontend/src/features/will/schemas/willSchemas.ts
@frontend/src/features/will/components/ChatSection.tsx
@frontend/src/features/will/components/PersonalForm.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: TrustSection and UsufructSection components</name>
  <files>
    frontend/src/features/will/components/TrustSection.tsx
    frontend/src/features/will/components/UsufructSection.tsx
  </files>
  <action>
    Both components follow the same pattern: AI chat section (reusing ChatSection) for conversational data collection. Each wraps ChatSection with scenario-specific context, and includes an info banner explaining the concept.

    **TrustSection.tsx**:

    Create a component that:
    1. Shows an info alert (DaisyUI `alert alert-info`) explaining: "A testamentary trust protects minor children's inheritance. Children under 18 cannot inherit directly in South Africa — assets must be held in trust until they reach a specified age."
    2. Renders ChatSection with section="trust" and the willId from store
    3. Above the chat, show a summary card if trust data already exists in store (trust name, vesting age, trustees)
    4. Uses DaisyUI card, alert, and badge components matching existing component patterns

    ```tsx
    import { useWillStore } from '../store/useWillStore.ts'
    import { ChatSection } from './ChatSection.tsx'

    interface TrustSectionProps {
      willId: string
    }

    export function TrustSection({ willId }: TrustSectionProps) {
      const trustProvisions = useWillStore((s) => s.trustProvisions)

      return (
        <div className="space-y-4">
          <div className="alert alert-info">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" className="h-6 w-6 shrink-0 stroke-current">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>A testamentary trust protects minor children's inheritance. In South Africa, children under 18 cannot inherit directly.</span>
          </div>

          {trustProvisions.trustName && (
            <div className="bg-base-200 rounded-lg p-3 text-sm">
              <p><strong>Trust:</strong> {trustProvisions.trustName}</p>
              {trustProvisions.vestingAge && <p><strong>Vesting age:</strong> {trustProvisions.vestingAge}</p>}
              {trustProvisions.trustees?.length > 0 && (
                <p><strong>Trustees:</strong> {trustProvisions.trustees.map(t => t.name).join(', ')}</p>
              )}
            </div>
          )}

          <ChatSection section="trust" willId={willId} />
        </div>
      )
    }
    ```

    **UsufructSection.tsx**:

    Create a component that:
    1. Shows an info alert: "A usufruct gives someone the right to USE and ENJOY a property for their lifetime, while actual ownership passes to other beneficiaries. The usufructuary does NOT own the property."
    2. Shows a warning alert: "Important: A usufruct is different from a fideicommissum. If you need conditional ownership transfer, please consult an attorney."
    3. Renders ChatSection with section="usufruct" and willId
    4. Above the chat, show summary if usufruct data exists (property, usufructuary, holders)

    Follow same structure as TrustSection. Use `alert alert-warning` for the fideicommissum distinction.
  </action>
  <verify>
    Read both files and confirm:
    - TrustSection renders info alert with SA context about minors
    - TrustSection renders ChatSection with section="trust"
    - TrustSection shows existing trust data summary
    - UsufructSection renders info alert about usufruct concept
    - UsufructSection renders warning about fideicommissum distinction
    - UsufructSection renders ChatSection with section="usufruct"
    - Both import from store and ChatSection
  </verify>
  <done>TrustSection and UsufructSection components provide AI-guided data collection with SA legal context banners and existing data summaries.</done>
</task>

<task type="auto">
  <name>Task 2: BusinessAssetsSection and JointWillSetup components</name>
  <files>
    frontend/src/features/will/components/BusinessAssetsSection.tsx
    frontend/src/features/will/components/JointWillSetup.tsx
  </files>
  <action>
    **BusinessAssetsSection.tsx**:

    Create a component that:
    1. Shows an info alert: "Business interests require special attention in your will. Close Corporation member interests need consent from remaining members under Section 35 of the CC Act."
    2. Renders ChatSection with section="business" and willId
    3. Above the chat, shows existing business assets from store as a list with badges for business type (CC, Pty Ltd, Partnership)
    4. For each CC-type asset, show a warning badge: "Requires member consent"

    ```tsx
    import { useWillStore } from '../store/useWillStore.ts'
    import { ChatSection } from './ChatSection.tsx'

    interface BusinessAssetsSectionProps {
      willId: string
    }

    export function BusinessAssetsSection({ willId }: BusinessAssetsSectionProps) {
      const businessAssets = useWillStore((s) => s.businessAssets)

      return (
        <div className="space-y-4">
          <div className="alert alert-info">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" className="h-6 w-6 shrink-0 stroke-current">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>Business interests require special attention. CC member interests need consent from remaining members (CC Act s35).</span>
          </div>

          {businessAssets.length > 0 && (
            <div className="bg-base-200 rounded-lg p-3 text-sm space-y-2">
              <p className="font-semibold">Business assets added:</p>
              {businessAssets.map((asset) => (
                <div key={asset.id} className="flex items-center gap-2">
                  <span className="badge badge-outline badge-sm">
                    {asset.businessType === 'cc_member_interest' ? 'CC' :
                     asset.businessType === 'company_shares' ? 'Pty Ltd' : 'Partnership'}
                  </span>
                  <span>{asset.businessName}</span>
                  {asset.businessType === 'cc_member_interest' && (
                    <span className="badge badge-warning badge-sm">Requires member consent</span>
                  )}
                </div>
              ))}
            </div>
          )}

          <ChatSection section="business" willId={willId} />
        </div>
      )
    }
    ```

    **JointWillSetup.tsx**:

    This component is different from others — it uses a FORM for co-testator details (like PersonalForm) rather than pure chat, because the data is structured and specific. The chat is for explaining implications.

    Create a component that:
    1. Shows a prominent warning alert (`alert alert-warning`): "Joint wills become effectively IRREVOCABLE after the first spouse passes away. The surviving spouse who accepts benefits is typically bound by all terms. Consider separate mirror wills for more flexibility."
    2. Has a form section (React Hook Form + Zod) for:
       - Co-testator first name, last name, ID number
       - Will structure radio: mutual vs mirror
       - Massing checkbox
       - Irrevocability acknowledgement checkbox (required)
    3. Below the form, renders ChatSection with section="joint" for explanatory conversation
    4. On form submit, calls updateJointWill on the store

    Use the same DaisyUI form patterns as PersonalForm.tsx (input, label, error text). Use `useForm` from react-hook-form with zodResolver and the `jointWillSchema` from willSchemas.ts.

    The form should be above the chat so users fill in details first, then discuss implications.
  </action>
  <verify>
    Read both files and confirm:
    - BusinessAssetsSection shows info about CC Act s35
    - BusinessAssetsSection renders existing assets with type badges
    - BusinessAssetsSection has "Requires member consent" badge for CC assets
    - BusinessAssetsSection renders ChatSection section="business"
    - JointWillSetup shows irrevocability warning alert
    - JointWillSetup has React Hook Form with zodResolver for co-testator details
    - JointWillSetup includes will_structure radio (mutual/mirror), massing, irrevocability checkbox
    - JointWillSetup renders ChatSection section="joint" below form
    - JointWillSetup calls updateJointWill on store
  </verify>
  <done>BusinessAssetsSection shows CC consent warnings and business asset summaries with AI chat. JointWillSetup provides structured co-testator form with irrevocability warning and explanatory chat.</done>
</task>

</tasks>

<verification>
- All 4 components import from store and ChatSection
- All 4 components receive willId prop
- Info/warning alerts use correct DaisyUI classes
- JointWillSetup uses React Hook Form with zodResolver
- BusinessAssetsSection shows CC consent warning badge
- Components follow existing codebase patterns (DaisyUI classes, store integration)
</verification>

<success_criteria>
- TrustSection renders with info banner and ChatSection section="trust"
- UsufructSection renders with info + warning banners and ChatSection section="usufruct"
- BusinessAssetsSection renders asset list with type badges and ChatSection section="business"
- JointWillSetup renders co-testator form + irrevocability warning + ChatSection section="joint"
</success_criteria>

<output>
After completion, create `.planning/phases/04-complex-estate-scenarios/04-04-SUMMARY.md`
</output>
